<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global AI Assistant</title>
    <link rel="icon" href="{{ url_for('static', filename='images/bot_icon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="chat-container">
        <header>
            <div class="profile-container">
                <img src="{{ url_for('static', filename='images/bot_main.png') }}" alt="Profile" class="main-profile">
                <div class="status-dot"></div>
            </div>
            <div class="header-text">
                <h1>Global Support AI</h1>
                <p>24/7 다국어 실시간 상담 서비스</p>
            </div>
        </header>

        <div id="chat-box" class="chat-box">
            <div class="msg-wrapper bot-wrapper">
                <img src="{{ url_for('static', filename='images/bot_icon.png') }}" class="chat-icon">
                <div class="message bot">안녕하세요,무엇이든 물어보세요. 입력하신 언어로 답변해 드립니다.</div>
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="user-input" placeholder="메시지를 입력하세요..." autocomplete="off">
            <button id="send-btn">
                <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
    </div>

    <script>
        function appendMessage(role, text) {
            let html = '';
            if (role === 'user') {
                html = `<div class="msg-wrapper user-wrapper"><div class="message user">${text}</div></div>`;
            } else {
                html = `
                    <div class="msg-wrapper bot-wrapper">
                        <img src="/static/images/bot_icon.png" class="chat-icon">
                        <div class="message bot">${text.replace(/\n/g, '<br>')}</div>
                    </div>`;
            }
            $('#chat-box').append(html);
            $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
        }

        function sendMessage() {
            const msg = $('#user-input').val().trim();
            if (!msg) return;

            appendMessage('user', msg);
            $('#user-input').val('');

            $.ajax({
                url: '/chat',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ message: msg }),
                success: function(data) {
                    appendMessage('bot', data.reply);
                },
                error: function() {
                    appendMessage('bot', '죄송합니다. 서버와 연결이 원활하지 않습니다.');
                }
            });
        }

        $('#send-btn').click(sendMessage);
        $('#user-input').keypress(e => { if(e.which == 13) sendMessage(); });
    </script>
</body>
</html>
